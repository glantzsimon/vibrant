@using K9.Base.WebApplication.Extensions
@using K9.Base.WebApplication.Helpers
@model Order
@{
    Layout = "../Shared/_LayoutForm.cshtml";
    ViewBag.SubTitle = $"{Model.Name} {Dictionary.OrderReview}";
}
@using (Html.BeginForm())
{
    using (Html.BeginBootstrapForm())
    {
        @Html.Hidden("index", 0)

        <div class="row">
            <div class="col-xs-12">
                @Html.BootstrapEditorFor(model => Model.OrderId)
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12">
                @Html.BootstrapActionLinkButton(K9.Base.Globalisation.Dictionary.CreateNew, "Create", "Orders", null, "fa-plus-circle")
            </div>
        </div>
    }
}

@using (Html.BeginForm("UpdateOrderProgress", "Orders"))
{
    using (Html.BeginBootstrapForm())
    {
        @Html.HiddenFor(e => e.Id)

        @Html.Partial("_OrderReviewSheet")

        <hr />

        @Html.BootstrapEditorFor(e => e.IsPaid)
        @Html.BootstrapEditorFor(e => e.IsMade)
        @Html.BootstrapEditorFor(e => e.IsComplete)

        @Html.Partial("_AjaxPopup")

        <hr />

        @Html.BootstrapButton(K9.Base.Globalisation.Dictionary.Update, EButtonType.Submit, "fa-save")
        @Html.BootstrapBackToListButton()
        @Html.BootstrapActionLinkButton(K9.Base.Globalisation.Dictionary.Previous, "OrderReview", null, new { id = Model.Id, index = -1 }, "fa-arrow-left")
        @Html.BootstrapActionLinkButton(K9.Base.Globalisation.Dictionary.Next, "OrderReview", null, new { id = Model.Id, index = 1 }, "fa-arrow-right")
    }
}

<script type="text/javascript">
    $(function () {

        $("#OrderId").change(function () {
            $("#OrderId").closest("form").submit();
        });

        $("#@(nameof(Order.IsPaid))").click(function() {
            var value = $(this).is(":checked");
            ajaxcontroller().send("@Url.Action("UpdateOrderIsPaid")",
                {
                    id: @Model.Id,
                    value: value
                }, "POST").done(
                function(result) {
                    if (!result.success) {
                        $("div#fail-popup").show();
                    } else {
                        $("div#success-popup").show();
                    }
                });
        });

        $("#@(nameof(Order.IsMade))").click(function() {
            var value = $(this).is(":checked");
            ajaxcontroller().send("@Url.Action("UpdateOrderIsMade")",
                {
                    id: @Model.Id,
                    value: value
                }, "POST").done(
                function(result) {
                    if (!result.success) {
                        $("div#fail-popup").show();
                    } else {
                        $("div#success-popup").show();
                    }
                });
        });

        $("#@(nameof(Order.IsComplete))").click(function() {
            var value = $(this).is(":checked");
            ajaxcontroller().send("@Url.Action("UpdateOrderIsComplete")",
                {
                    id: @Model.Id,
                    value: value
                }, "POST").done(
                function(result) {
                    if (!result.success) {
                        $("div#fail-popup").show();
                    } else {
                        $("div#success-popup").show();
                    }
                });
        });

    })
</script>