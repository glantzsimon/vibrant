@using K9.Base.WebApplication.Extensions
@using K9.Base.WebApplication.Helpers
@using K9.DataAccessLayer.Enums
@using K9.SharedLibrary.Authentication
@using K9.WebApplication.Helpers
@using K9.WebApplication.Options
@using K9.WebApplication.ViewModels
@using K9.SharedLibrary.Extensions
@model Protocol

@{
    var wellClass = "";

    if (ViewBag.ProtocolView != null)
    {
        wellClass = "well";
    }
}

@using (Html.BeginForm())
{
    using (Html.BeginBootstrapForm())
    {
        @Html.HiddenFor(e => Model.Id)
        @Html.HiddenFor(e => Model.ExternalId)

        <div class="row margin-bottom-15">
            <div class="col-xs-12">
                @Html.BootstrapActionLinkButton(Dictionary.ViewPrintableVersion, "PrintableSummary", "Protocol", new { id = Model.ExternalId }, "fa fa-eye", EButtonClass.Success)

                @if (Model.Type != EProtocolType.AutoGenerated)
                {
                    if (Model.ProductPacks != null && Model.ProductPacks.Any())
                    {
                        foreach (var protocolProductPack in Model.ProductPacks)
                        {
                            @Html.BootstrapActionLinkButton($"{Dictionary.View} {protocolProductPack.ProductPack.Name}", "Details", "ProductPack", new { seoFriendlyId = protocolProductPack.ProductPack.SeoFriendlyId }, "", EButtonClass.Success)
                        }
                    }
                }

                @if (K9.WebApplication.Helpers.SessionHelper.CurrentUserIsAdmin())
                {
                    @Html.BootstrapBackToListButton()
                }
            </div>
        </div>

        if (K9.WebApplication.Helpers.SessionHelper.CurrentUserIsAdmin())
        {
            <div class="row">
                <div class="col-xs-12">
                    @Html.BootstrapEditorFor(model => Model.ProtocolId)
                </div>
            </div>
        }

        <div class="row">
            <div class="col-xs-12">
                @Html.Raw(Model.ShortDescription)
            </div>
        </div>

        if (Model.ProtocolSections.Any() &&
            (Model.Type == EProtocolType.Default ||
             Model.Type == EProtocolType.ParasiteCleanse ||
             Model.Type == EProtocolType.ParasiteCleanseMaintenance) ||
            Model.Type == EProtocolType.AutoGenerated && Model.IsScheduleDisplayed)
        {
            <hr />
            @Html.Partial("../Protocols/_Schedule")
        }


        if (Model.Type == EProtocolType.Default)
        {
            @Html.Partial("../Protocols/_SupplementsList")
        }
    }
}

<div class="@wellClass">
    <ul class="nav nav-pills">
        @if (Model.Type == EProtocolType.AutoGenerated)
        {
            <li>
                <a data-toggle="pill" href="#genotype">
                    <span class="site-controls-text">
                        @Dictionary.GenoType
                    </span>
                </a>
            </li>
            <li>
                <a data-toggle="pill" href="#doshas">
                    <span class="site-controls-text">
                        @Dictionary.Doshas
                    </span>
                </a>
            </li>
            <li>
                <a data-toggle="pill" href="#ninestarki">
                    <span class="site-controls-text">
                        @Dictionary.NineStarKi
                    </span>
                </a>
            </li>
        }
        @if (Model.RecommendedFoods != null && Model.RecommendedFoods.Any())
        {
            <li class="active">
                <a data-toggle="pill" href="#recommended-foods">
                    <span class="site-controls-text">
                        @Dictionary.RecommendedFoods
                    </span>
                </a>
            </li>
        }
        @if (Model.DietaryRecommendations != null && Model.DietaryRecommendations.Any())
        {
            <li>
                <a data-toggle="pill" href="#dietary-recommendations">
                    <span class="site-controls-text">
                        @Dictionary.DietaryAdvice
                    </span>
                </a>
            </li>
        }
        @if (Model.Activities != null && Model.Activities.Any())
        {
            <li>
                <a data-toggle="pill" href="#activities">
                    <span class="site-controls-text">
                        @Dictionary.RecommendedActivitties
                    </span>
                </a>
            </li>
        }
        @if (Model.Type == EProtocolType.AutoGenerated && Model.Products != null && Model.Products.Any())
        {
            <li>
                <a data-toggle="pill" href="#recommended-products">
                    <span class="site-controls-text">
                        @Dictionary.RecommendedProducts
                    </span>
                </a>
            </li>
        }
        @if (Model.Type == EProtocolType.AutoGenerated && Model.ProductPacks != null && Model.ProductPacks.Any())
        {
            <li>
                <a data-toggle="pill" href="#recommended-productpacks">
                    <span class="site-controls-text">
                        @Dictionary.RecommendedProductPacks
                    </span>
                </a>
            </li>
        }
    </ul>

    <div class="tab-content">
        @if (Model.Type == EProtocolType.AutoGenerated)
        {
            <div id="genotype" class="tab-pane fade padding-top-15">
                <div class="well">
                    <div class="row">
                        <div class="col-xs-12">
                            @Html.Raw(typeof(Dictionary).GetValueFromResource(Model.GenoTypeDetailsName))
                        </div>
                    </div>
                    <hr />
                </div>
            </div>

            <div id="doshas" class="tab-pane fade padding-top-15">
                <div class="well">
                    <div class="row">
                        <div class="col-xs-12">
                            @Html.Partial("../Protocols/_DoshasSummary")
                        </div>
                    </div>
                    <hr />
                </div>
            </div>

            <div id="ninestarki" class="tab-pane fade padding-top-15">
                <div class="well">
                    <div class="row">
                        <div class="col-xs-12">
                            @Html.Partial("../Protocols/_NineStarKiSummary", Model.NineStarKi)
                        </div>
                    </div>
                    <hr />
                </div>
            </div>
        }
        <div id="recommended-foods" class="tab-pane fade active in padding-top-15">
            @if (Model.RecommendedFoods != null && Model.RecommendedFoods.Any())
            {
                <div class="well">
                    <div class="row margin-top-0">
                        <div class="col-xs-12">
                            <h3 class="margin-top-0">@Dictionary.RecommendedFoods</h3>
                            <hr />
                        </div>
                    </div>

                    <div class="row margin-top-0">
                        <div class="col-xs-12">
                            <div class="alert alert-success">
                                <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                                <h4>@Dictionary.WhyOrganicFoodTitle</h4>
                                @Html.ImagePanel(new PanelOptions
                                {
                                    ImageLayout = EPanelImageLayout.Cover,
                                    ImageSrc = "../Images/nutrition/organic-food.jpg",
                                    ImageSize = EPanelImageSize.Medium
                                })
                                <p>@Html.Raw(Dictionary.organicfood)</p>
                            </div>
                        </div>
                    </div>

                    @if (Model.ClientId.HasValue)
                    {
                        <div class="row margin-top-0">
                            <div class="col-xs-12">
                                <div class="alert alert-info">
                                    <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                                    <h4>@Dictionary.WeAreAllUnique</h4>
                                    <p>@Dictionary.DemoteFoodsDescription</p>
                                </div>
                            </div>
                        </div>

                        <div class="row margin-top-0">
                            <div class="col-xs-12">
                                <div class="well">
                                    @using (Html.BeginForm(null, null, FormMethod.Post))
                                    {
                                        @Html.AntiForgeryToken()
                                        @Html.HiddenFor(e => Model.Id)
                                        @Html.HiddenFor(e => Model.ExternalId)
                                        @Html.HiddenFor(e => Model.ClientId)

                                        <div class="row margin-top-0">
                                            <div class="col-xs-12">
                                                <h4 class="margin-top-0">@Dictionary.DietaryPreferences</h4>
                                                <hr />
                                            </div>

                                            <div class="col-xs-12">
                                                <p class="margin-top-0"><strong>@Dictionary.FoodCategoriesQuestionTitle</strong></p>
                                            </div>
                                            <div class="col-xs-12 padding-0">
                                                <div class="col-xs-6 padding-0">
                                                    <div class="col-xs-12 col-sm-6">
                                                        @Html.BootstrapEditorFor(e => e.EatsRedMeat)
                                                    </div>
                                                    <div class="col-xs-12 col-sm-6">
                                                        @Html.BootstrapEditorFor(e => e.EatsPoultry)
                                                    </div>
                                                </div>
                                                <div class="col-xs-6 padding-0">
                                                    <div class="col-xs-12 col-sm-6">
                                                        @Html.BootstrapEditorFor(e => e.EatsFishAndSeafood)
                                                    </div>
                                                    <div class="col-xs-12 col-sm-6">
                                                        @Html.BootstrapEditorFor(e => e.EatsDairy)
                                                    </div>
                                                </div>
                                                <div class="col-xs-6 padding-0">
                                                    <div class="col-xs-12 col-sm-6">
                                                        @Html.BootstrapEditorFor(e => e.EatsVegetables)
                                                    </div>
                                                    <div class="col-xs-12 col-sm-6">
                                                        @Html.BootstrapEditorFor(e => e.EatsFungi)
                                                    </div>
                                                </div>
                                                <div class="col-xs-6 padding-0">
                                                    <div class="col-xs-12 col-sm-6">
                                                        @Html.BootstrapEditorFor(e => e.EatsFruit)
                                                    </div>
                                                    <div class="col-xs-12 col-sm-6">
                                                        @Html.BootstrapEditorFor(e => e.EatsGrains)
                                                    </div>
                                                </div>
                                                <div class="col-xs-12 padding-0">
                                                    <div class="col-xs-11">
                                                        @Html.BootstrapEditorFor(e => e.EatsVegetableProtein)
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-xs-12">
                                                <hr />
                                            </div>
                                            <div class="col-xs-12">
                                                <p class="margin-top-0"><strong>@Dictionary.OtherDietaryPreferencesQuestionTitle</strong></p>
                                            </div>
                                            <div class="col-xs-12 padding-0">
                                                <div class="col-xs-6 padding-0">
                                                    <div class="col-xs-12 col-sm-6">
                                                        @Html.BootstrapEditorFor(e => e.IsLowOxalate)
                                                    </div>
                                                    <div class="col-xs-12 col-sm-6">
                                                        @Html.BootstrapEditorFor(e => e.IsLowLectin)
                                                    </div>
                                                </div>
                                                <div class="col-xs-6 padding-0">
                                                    <div class="col-xs-12 col-sm-6">
                                                        @Html.BootstrapEditorFor(e => e.IsLowPhytate)
                                                    </div>
                                                    <div class="col-xs-12 col-sm-6">
                                                        @Html.BootstrapEditorFor(e => e.IsLowHistamine)
                                                    </div>
                                                </div>
                                                <div class="col-xs-6 padding-0">
                                                    <div class="col-xs-12 col-sm-6">
                                                        @Html.BootstrapEditorFor(e => e.IsLowMycotoxin)
                                                    </div>
                                                    <div class="col-xs-12 col-sm-6">
                                                        @Html.BootstrapEditorFor(e => e.IsLowOmega6)
                                                    </div>
                                                </div>
                                                <div class="col-xs-6 padding-0">
                                                    <div class="col-xs-12 col-sm-6">
                                                        @Html.BootstrapEditorFor(e => e.IsBulletProof)
                                                    </div>
                                                    <div class="col-xs-12 col-sm-6">
                                                        @Html.BootstrapEditorFor(e => e.IsLowSulphur)
                                                    </div>
                                                </div>
                                                <div class="col-xs-6 padding-0">
                                                    <div class="col-xs-12 col-sm-6">
                                                        @Html.BootstrapEditorFor(e => e.IsSattvic)
                                                    </div>
                                                    <div class="col-xs-12 col-sm-6">
                                                        @Html.BootstrapEditorFor(e => e.IsKeto)
                                                    </div>
                                                </div>
                                                <div class="col-xs-6 padding-0">
                                                    <div class="col-xs-12 col-sm-6">
                                                        @Html.BootstrapEditorFor(e => e.IsLowGoitrogen)
                                                    </div>
                                                    <hr />
                                                </div>
                                            </div>
                                            <div class="col-xs-12">
                                                @Html.CollapsiblePanel(K9.Globalisation.Dictionary.MoreDetails, Html.Partial("_DietaryPreferenesMoreInfo").ToString())
                                            </div>
                                            <div class="col-xs-12">
                                                <hr />
                                            </div>
                                            <div class="col-xs-12">
                                                <div class="alert alert-success">
                                                    <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                                                    <h4>@Dictionary.YouHaveFlexibility</h4>
                                                    <div>@Html.Raw(Dictionary.flexible_foods)</div>
                                                </div>
                                            </div>
                                            <div class="col-xs-12">
                                                @Html.BootstrapEditorFor(e => e.AutomaticallyFilterFoods)
                                            </div>
                                            <div class="col-xs-12">
                                                <div id="health-level-container" disabled="disabled">
                                                    @Html.BootstrapEditorFor(e => e.CurrentHealthLevel)
                                                </div>
                                            </div>
                                            <div class="col-xs-12">
                                                <hr />
                                            </div>
                                            <div class="col-xs-12">
                                                @Html.BootstrapButton(K9.Globalisation.Dictionary.UpdatePreferences, EButtonType.Submit, "fa-save")
                                                @Html.BootstrapActionLinkButton(K9.Globalisation.Dictionary.PrintableFoodList, "PrintableFoodList", "Protocol", new { id = Model.ExternalId }, "fa-print")
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    }

                    <div class="row">
                        <div class="col-xs-12">
                            @Html.Partial("../Protocols/_RecommendedFoods", new RecommendedFoodsViewModel
                            {
                                ClientId = Model.ClientId,
                                GenoType = Model.GenoType,
                                Protocol = Model,
                                RecommendedFoods = Model.RecommendedFoods.Select(e =>
                                {
                                    var foodItem = e.FoodItem;
                                    foodItem.Score = e.Score;
                                    foodItem.RelativeScore = e.RelativeScore;
                                    return foodItem;
                                }).ToList()
                            })
                        </div>
                    </div>
                </div>
            }
        </div>

        <div id="dietary-recommendations" class="tab-pane fade padding-top-15">
            @if (Model.DietaryRecommendations != null && Model.DietaryRecommendations.Any())
            {
                <div class="well">
                    <div class="row margin-top-0">
                        <div class="col-xs-12">
                            <h3 class="margin-top-0">@Dictionary.DietaryAdvice</h3>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-12">
                            @Html.Partial("../Protocols/_DietaryRecommendationsSummary")
                        </div>
                    </div>
                    <hr />
                </div>

                <div class="well">
                    <div class="row margin-top-0">
                        <div class="col-xs-12">
                            <h3 class="margin-top-0">@Dictionary.DietaryAdvice - @Dictionary.Details</h3>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-12">
                            @Html.Partial("../Protocols/_DietaryRecommendationsFields")
                        </div>
                    </div>
                </div>
            }
        </div>

        <div id="activities" class="tab-pane fade padding-top-15">
            @if (Model.Activities != null && Model.Activities.Any())
            {
                <div class="well">
                    <div class="row margin-top-0">
                        <div class="col-xs-12">
                            <h3 class="margin-top-0">@Dictionary.RecommendedActivitties</h3>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-12">
                            @Html.Partial("../Protocols/_ActivitiesSummary")
                        </div>
                    </div>
                </div>

                <div class="well">
                    <div class="row margin-top-0">
                        <div class="col-xs-12">
                            <h3 class="margin-top-0">@Dictionary.RecommendedActivitties - @Dictionary.Details</h3>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-12">
                            @Html.Partial("../Protocols/_ActivityFields")
                        </div>
                    </div>
                </div>
            }
        </div>

        <div id="recommended-products" class="tab-pane fade padding-top-15">
            @if (Model.Products != null && Model.Products.Any())
            {
                <div class="well">
                    <div class="row margin-top-0">
                        <div class="col-xs-12">
                            <h3 class="margin-top-0">@Dictionary.RecommendedProducts</h3>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-12">
                            @Html.Partial("../Protocols/_RecommendedProducts")
                        </div>
                    </div>
                </div>
            }
        </div>

        <div id="recommended-productpacks" class="tab-pane fade padding-top-15">
            @if (Model.Products != null && Model.Products.Any())
            {
                <div class="well">
                    <div class="row margin-top-0">
                        <div class="col-xs-12">
                            <h3 class="margin-top-0">@Dictionary.RecommendedProductPacks</h3>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-12">
                            @Html.Partial("../Protocols/_RecommendedProductPacks")
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

<script type="text/javascript">
    $(window).on("load",
        function () {

            $("#ProtocolId").change(function () {
                $("#ProtocolId").closest("form").submit();

            })

        });
</script>
